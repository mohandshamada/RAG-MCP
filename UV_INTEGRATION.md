# UV Integration Guide for MCP RAG Server

## What is UV?

`uv` is a blazingly fast Python package installer and resolver written in Rust. It's:
- **10-100x faster** than pip
- **Deterministic** (reproducible installs)
- **Drop-in replacement** for pip
- **Supports all pip features**
- **Works with pyproject.toml**

## Quick Start with UV

### 1. Install UV

**Windows (PowerShell):**
```powershell
irm https://astral.sh/uv/install.ps1 | iex
```

**macOS/Linux:**
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### 2. Verify Installation

```bash
uv --version
```

Expected output: `uv 0.x.x`

### 3. Initialize Project with UV

```bash
cd C:\Users\engmo\OneDrive\Documents\Claude_Project\pdf_rag_mcp_server

# Create UV lock file
uv pip compile pyproject.toml -o requirements.lock

# Or use shorthand (recommended)
uv lock
```

## Installation Methods

### Method 1: Development Installation (Recommended)

```bash
# Install all dependencies including dev tools
uv pip install -e ".[dev]"

# Or specific groups
uv pip install -e ".[dev,test]"
```

### Method 2: Production Installation

```bash
# Install only runtime dependencies
uv pip install .

# With optional GPU support
uv pip install ".[gpu]"
```

### Method 3: From Lock File (Reproducible)

```bash
# Create lock file
uv lock

# Install from lock (exact same environment)
uv pip sync requirements.lock

# For dev
uv pip sync requirements-dev.lock --all-extras
```

### Method 4: Quick Start Script

```bash
# Run the provided setup script
python scripts/setup_with_uv.py
```

## File Structure with UV

```
pdf_rag_mcp_server/
├── pyproject.toml          # Project config (updated for uv)
├── uv.lock                 # Lock file (generated by uv lock)
├── requirements.txt        # Legacy (still supported)
├── requirements.lock       # Generated by uv
├── requirements-dev.lock   # Dev dependencies
│
├── src/
│   ├── __init__.py
│   ├── rag_server.py       # Main MCP server
│   └── comparison_engine.py
│
├── scripts/
│   ├── setup_with_uv.py    # UV setup script
│   ├── setup_env.sh        # Linux/macOS setup
│   └── setup_env.ps1       # Windows setup
│
├── tests/
│   ├── __init__.py
│   ├── test_rag_server.py
│   └── test_comparison_engine.py
│
├── .venv/                  # Virtual environment
├── data/                   # Runtime data
├── logs/                   # Application logs
└── config/                 # Configuration files
```

## UV Commands

### Basic Commands

```bash
# Check UV version
uv --version

# Show Python versions available
uv python list

# Install with specific Python version
uv pip install --python 3.12 .

# View installed packages
uv pip list

# Show package info
uv pip show pdf-rag-mcp-server
```

### Dependency Management

```bash
# Compile dependencies to lock file
uv lock

# Update lock file
uv lock --upgrade

# Install from lock file
uv pip sync

# Install specific dependency
uv pip install "langchain>=0.1.0"

# Add new dependency
uv pip install "new-package" && uv lock
```

### Virtual Environment

```bash
# Create virtual environment
uv venv .venv

# Activate (Windows)
.venv\Scripts\activate

# Activate (Linux/macOS)
source .venv/bin/activate

# Python directly in venv
uv run python main.py

# Or use venv
.venv/bin/python main.py
```

### Development Workflow

```bash
# Install in editable mode with dev dependencies
uv pip install -e ".[dev]"

# Run tests
uv run pytest

# Format code
uv run black .

# Lint
uv run ruff check .

# Type check
uv run mypy src/

# All at once
uv run black . && uv run ruff check . && uv run pytest
```

## Setting Up with UV (Step-by-Step)

### Step 1: Install UV

**Windows:**
```powershell
irm https://astral.sh/uv/install.ps1 | iex
```

### Step 2: Navigate to Project

```bash
cd C:\Users\engmo\OneDrive\Documents\Claude_Project\pdf_rag_mcp_server
```

### Step 3: Create Virtual Environment

```bash
uv venv
source .venv/bin/activate  # macOS/Linux
# or
.venv\Scripts\activate     # Windows
```

### Step 4: Install Project with Dependencies

```bash
# Development setup
uv pip install -e ".[dev]"

# Production setup
uv pip install .
```

### Step 5: Generate Lock File

```bash
uv lock
```

### Step 6: Verify Installation

```bash
uv pip list
python -c "import src; print('✓ Project installed successfully')"
```

## Comparison: pip vs UV

| Task | pip | uv |
|------|-----|-----|
| Install dependencies | `pip install -r requirements.txt` | `uv pip install -r requirements.txt` |
| Initial install | 1-5 min | 5-30 seconds |
| Update packages | `pip install --upgrade pip` | `uv pip install --upgrade pip` |
| Check packages | `pip list` | `uv pip list` |
| Create lock file | Manual | `uv lock` |
| Resolve conflicts | Manual | Automatic |
| Reproducible builds | No | Yes |

## UV with Claude Desktop

### 1. Configure Claude Desktop

Update your `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "rag-server": {
      "command": "uv",
      "args": ["run", "--python", "3.12", "src/rag_server.py"],
      "env": {
        "PYTHONPATH": "${workspaceFolder}/src"
      }
    }
  }
}
```

### 2. Using UV with MCP Server

```bash
# Run server with UV
uv run --python 3.12 src/rag_server.py

# Or in development
uv run --python 3.12 -m src.rag_server
```

## Troubleshooting

### Issue: "uv not found"

**Solution:** Add UV to PATH
```powershell
# Windows
$env:PATH += ";C:\Users\engmo\.cargo\bin"
```

### Issue: "Python not found"

**Solution:** Specify Python version
```bash
uv venv --python 3.12
```

### Issue: "Lock file conflicts"

**Solution:** Regenerate lock file
```bash
uv lock --upgrade
```

### Issue: "Package not in lock file"

**Solution:** Add to pyproject.toml and regenerate
```bash
# Edit pyproject.toml, then:
uv lock
uv pip sync
```

## Advanced Configuration

### Custom Python Version

```bash
# Use specific Python
uv run --python 3.12 main.py

# List available
uv python list

# Install specific version
uv python install 3.12.0
```

### Pre-release Packages

```bash
# Allow pre-releases
uv pip install --pre "langchain"

# Include in lock file
uv lock --allow-prereleases
```

### Custom Index

```bash
# Use custom PyPI mirror
uv pip install --index-url https://mirror.example.com/simple .
```

### Offline Mode

```bash
# Generate lock file online
uv lock

# Use offline
uv pip sync --offline
```

## UV with CI/CD

### GitHub Actions Example

```yaml
name: Test with UV

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: astral-sh/setup-uv@v2
        with:
          python-version: "3.12"
      
      - name: Install dependencies
        run: uv pip sync --all-extras
      
      - name: Run tests
        run: uv run pytest
      
      - name: Lint
        run: uv run ruff check .
      
      - name: Type check
        run: uv run mypy src/
```

## UV with Docker

```dockerfile
FROM python:3.12-slim

# Install UV
RUN pip install uv

WORKDIR /app
COPY . .

# Install with UV
RUN uv pip install --system .

CMD ["python", "src/rag_server.py"]
```

## Best Practices

### 1. Always Commit Lock File

```bash
git add uv.lock
git commit -m "Update dependencies"
```

### 2. Use Specific Versions for Production

```toml
dependencies = [
    "langchain==0.1.0",  # Specific version
    "numpy>=1.24,<2.0",  # Version range
]
```

### 3. Keep Development Separated

```toml
[project.optional-dependencies]
dev = ["black", "ruff", "pytest"]  # Dev only
```

### 4. Regular Updates

```bash
# Check for updates
uv lock --upgrade

# Then test
uv run pytest
```

## Migration from pip

If you're migrating from pip:

```bash
# 1. Keep requirements.txt for reference
cp requirements.txt requirements.txt.backup

# 2. Create UV project
uv lock

# 3. Install with UV
uv pip install -e .

# 4. Test installation
python -m pytest

# 5. Commit changes
git add pyproject.toml uv.lock
git commit -m "Migrate to UV package manager"
```

## Resources

- **UV Official Docs:** https://docs.astral.sh/uv/
- **UV GitHub:** https://github.com/astral-sh/uv
- **pyproject.toml Spec:** https://packaging.python.org/specifications/pyproject-toml/
- **PEP 518:** https://peps.python.org/pep-0518/
- **PEP 621:** https://peps.python.org/pep-0621/

## Next Steps

1. ✅ Install UV
2. ✅ Create virtual environment: `uv venv`
3. ✅ Install dependencies: `uv pip install -e ".[dev]"`
4. ✅ Generate lock file: `uv lock`
5. ✅ Run tests: `uv run pytest`
6. ✅ Update Claude Desktop config
7. ✅ Start development!

---

**Questions?** Check the UV documentation or create an issue on the GitHub repository.
